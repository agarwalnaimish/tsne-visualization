<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>t-SNE Visualizer</title>

<script src="jquery-1.8.3.min.js"></script>
<script src="d3.min.js"></script>
<script src="tsne.js"></script>
<script src="fpsmeter.min.js"></script>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,300' rel='stylesheet' type='text/css'>

<style>
body {
  font-family: 'Roboto', sans-serif;
  color: #333;
  font-weight: 300;
  font-size: 16px;
}
svg {
  border: 1px solid #333;
}
#wrap {
  width: 80%;
  margin-left: auto;
  margin-right: auto;
}
#embed {
  margin-top: 10px;
}
h1 {
  text-align: center;
  font-weight: normal;
}
.tt {
  margin-top: 10px;
  background-color: #EEE;
  border-bottom: 1px solid #333;
  padding: 5px;
}
.txth {
  color: #F55;
}
.cit {
  font-family: courier;
  padding-left: 20px;
  font-size: 14px;
}
</style>

<script>
(function() {
  "use strict";

  var T, Y;
  var svg;
  var data;
  var config;
  var fpsMeter;

  function updateEmbedding() {
    svg.selectAll('.obj')
      .data(data.labels)
      .attr("transform", function(d, i) { 
        var XY = getXY(Y[i])
        return "translate(" + XY.x + "," + XY.y + ")";
      });
  }

  function getXY(Y) {
    return {
      x: (Y[0] * config.spreadFactor * ss + tx) + (config.embedWindowX / 2),
      y: (Y[1] * config.spreadFactor * ss + ty) + (config.embedWindowY / 2)
    }
  }

  function createObjects() {
      $("#embed").empty();
      var div = d3.select("#embed");
    
      svg = div.append("svg") // svg is global
      .attr("width", config.embedWindowX)
      .attr("height", config.embedWindowY);

      var g = svg.selectAll(".b")
        .data(data.labels)
        .enter().append("g")
        .attr("class", "obj");
    
      // Check if images are included with meta
      if (data.images && config.showImages) {
        g.append("svg:image")
	  .attr('x', 0)
          .attr('y', 2)
	  .attr('width', config.thumbImgSize)
	  .attr('height', config.thumbImgSize)
	  .attr("xlink:href", function(d, i) { return "data/" + data.images[i]; })
          .on('mouseover', function() {	
            $(this).attr('width', config.hoverImgSize);
	    $(this).attr('height', config.hoverImgSize);
          })
          .on('mouseout', function() {
	    $(this).attr('width', config.thumbImgSize);
	    $(this).attr('height', config.thumbImgSize);
          })
      }

      if (data.labels && config.showLabels) {
        g.append("text")
	  .attr("text-anchor", "top")
  	  .attr("font-size", 12)
	  .attr("fill", "#333")
	  .text(function(d, i) { return data.labels[i]; });
      }

      var zoomListener = d3.behavior.zoom()
        .scaleExtent([0.1, 100])
        .center([0,0])
        .on("zoom", zoomHandler);
      zoomListener(svg);
  }

  var tx=0, ty=0;
  var ss=1;
  function zoomHandler() {
    tx = d3.event.translate[0];
    ty = d3.event.translate[1];
    ss = d3.event.scale;
  }

  function step() {
    fpsMeter.tickStart();

    for(var step=0; step<config.stepsBeforeUpdate; step++) {
      T.step();
    }
    Y = T.getSolution();
    updateEmbedding();
    
    fpsMeter.tick();
  }

  $(window).load(function() {
    fpsMeter = new FPSMeter();

    $.getJSON("config.json", function(configJson) {
      config = configJson
      T = new tsnejs.tSNE({
        epsilon: config.epsilon, 
        perplexity: config.perplexity
      });

      $.getJSON("data/data.json", function(dataJson) {
        data = dataJson;
        T.initDataDist(data.weights); // init embedding
        createObjects(); // draw initial objects
        setInterval(step, 10);
      });    
    });
  });

})();

</script>

</head>

<body>
<div id="wrap">
<h1>t-SNE Visualization Utility</h1>
<div class="sec">
  t-SNE is a visualization algorithm that embeds things in 2 or 3 dimensions according to some desired distances. If you have some data and you can measure their pairwise differences, t-SNE visualization can help you identify various clusters. This visualizer uses <a href="https://github.com/karpathy/tsnejs">tSNEJS</a> from kaparthy to compute lower dimensional embeddings.

  <br><br> <span class="txth">Go ahead, pan and zoom around with mouse!</span>
  <br> (Note that can take a while to load all images...)
</div>

<div id="embed"></div>
<br>

<div class="tt">Algorithm Details</div>
<div class="sec">
  The algorithm is described in this paper:

  <div class="cit">
  <br>L.J.P. van der Maaten and G.E. Hinton. 
  <br>Visualizing High-Dimensional Data Using t-SNE. Journal of Machine Learning Research 9(Nov):2579-2605, 2008. 
  <br><a href="http://jmlr.csail.mit.edu/papers/volume9/vandermaaten08a/vandermaaten08a.pdf">[PDF]</a> <a href="http://jmlr.csail.mit.edu/papers/volume9/vandermaaten08a/vandermaaten08a-supplement.pdf">[Supplemental Material (24MB)]</a>
  </div>

  <br>
  In short, the algorithm computes a matrix P that is related to distances between all elements in the original space. The variables of the problem are the embedding point locations, which similarily rise to their own distance matrix Q. The algorithm's cost function then minimizes the difference between P and Q. 
</div>
<br><br>
</body>

</html>
